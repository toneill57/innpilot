# PROMPTS WORKFLOW - VPS Deployment Migration

**Proyecto:** VPS Deployment Migration (Vercel ‚Üí Hostinger + GitHub Actions)
**Archivos de referencia:** `plan.md` (610 l√≠neas) + `TODO.md` (208 l√≠neas)

---

## üéØ Contexto General (Usar SIEMPRE primero en nuevas conversaciones)

```
CONTEXTO DEL PROYECTO: VPS Deployment Migration

Estoy trabajando en migrar InnPilot de Vercel a VPS Hostinger con despliegue autom√°tico v√≠a GitHub Actions.

ARCHIVOS CLAVE:
- plan.md ‚Üí Plan completo del proyecto (610 l√≠neas, 5 fases)
- TODO.md ‚Üí 28 tareas organizadas por fases
- vps-deployment-workflow.md ‚Üí Este archivo con prompts ejecutables

OBJETIVO:
Eliminar dependencia de Vercel y configurar deployment autom√°tico push-to-dev en VPS (innpilot.io)

STACK DEPLOYMENT:
- CI/CD: GitHub Actions
- VPS: Hostinger (Ubuntu 22.04)
- Web Server: Nginx (reverse proxy)
- Process Manager: PM2 (cluster mode)
- SSL: Let's Encrypt (Certbot)

ESTADO ACTUAL:
- ‚úÖ App funcionando en Vercel (https://innpilot.vercel.app)
- ‚úÖ GitHub repo: https://github.com/toneill57/innpilot.git
- üîú Migrar a VPS con GitHub Actions

Por favor, confirma que entiendes el contexto antes de continuar.
```

---

## FASE 1: Limpieza de Vercel (1h)

### Prompt 1.1: Eliminar vercel.json

```
oye tu @backend-developer ahora Eliminar vercel.json y limpiar referencias a Vercel

CONTEXTO:
- Proyecto: VPS Deployment Migration (ver plan.md)
- Archivo actual: vercel.json (37 l√≠neas de configuraci√≥n Vercel)
- Objetivo: Remover toda dependencia de Vercel

ESPECIFICACIONES:

1. Eliminar archivo vercel.json
   - Archivo completo: /Users/oneill/Sites/apps/InnPilot/vercel.json
   - Contiene: regions, buildCommand, functions config, CORS headers

2. Actualizar package.json
   - Eliminar l√≠nea 26: `"deploy": "npm run pre-deploy && vercel --prod"`
   - Mantener: build, start, dev, test scripts

3. Actualizar .gitignore
   - Eliminar l√≠nea 36: `# vercel`
   - Eliminar l√≠nea 37: `.vercel`

ARCHIVOS:
- Eliminar: vercel.json
- Modificar: package.json (l√≠nea 26)
- Modificar: .gitignore (l√≠neas 36-37)

TEST:
```bash
# Verificar vercel.json eliminado
git status | grep "deleted:.*vercel.json"

# Verificar package.json sin deploy script
grep -c "deploy.*vercel" package.json  # Debe retornar 0

# Verificar .gitignore limpio
grep -i vercel .gitignore  # Debe retornar vac√≠o
```

SIGUIENTE: Prompt 1.2 para refactor deploy-agent.md
```

---

### Prompt 1.2: Refactor deploy-agent.md

```
ahora tu mismo, @backend-developer ay√∫dame con el Refactor completo de deploy-agent.md para VPS workflow

CONTEXTO:
Eliminar monitoreo de Vercel y actualizar workflow para GitHub Actions + VPS

ARCHIVOS:
- Leer: .claude/agents/deploy-agent.md (257 l√≠neas)
- Modificar: .claude/agents/deploy-agent.md

ESPECIFICACIONES:

1. Actualizar URL de producci√≥n
   - Cambiar: `https://innpilot.vercel.app` ‚Üí `https://innpilot.io`
   - En todas las ocurrencias del archivo

2. Eliminar secciones:
   - "Paso 4: Monitoreo de Deploy en Vercel"
   - "Configuraci√≥n del Agent > deployUrl"
   - Referencias a Vercel dashboard/CLI

3. Actualizar workflow del agente:
   ```markdown
   ## Workflow
   1. **Commit Autom√°tico**: Analiza cambios y genera commit descriptivo
   2. **Push a GitHub**: Ejecuta git push origin dev
   3. **Monitoreo GitHub Actions**: Verifica que workflow complete (opcional)
   4. **Verificaci√≥n Funcional**: Prueba endpoints en https://innpilot.io
   5. **Reporte**: Genera reporte de deployment con m√©tricas
   ```

4. Mantener verificaci√≥n de endpoints:
   - `https://innpilot.io/api/health`
   - `https://innpilot.io/api/chat`
   - `https://innpilot.io/api/chat/muva`

5. Actualizar ejemplo de ejecuci√≥n exitosa:
   - Eliminar: "Monitoreando deploy en Vercel..."
   - Agregar: "Push a GitHub completado ‚Üí GitHub Actions deploying"

TEST:
```bash
# Verificar URL actualizada
grep -c "innpilot.io" .claude/agents/deploy-agent.md  # Debe retornar >3

# Verificar Vercel solo en contexto hist√≥rico
grep -i "vercel" .claude/agents/deploy-agent.md | grep -v -i "hist√≥rico\|legacy\|anteriormente"  # Debe retornar vac√≠o

# Verificar workflow actualizado
grep -c "GitHub Actions" .claude/agents/deploy-agent.md  # Debe retornar >1
```

SIGUIENTE: Prompt 1.3 para actualizar README.md
```

---

### Prompt 1.3: ahora para Actualizar README.md ve tu de nuevo
@backend-developer para 

TAREA: Actualizar secci√≥n de Deploy en README.md

CONTEXTO:
README.md tiene referencias a Vercel que deben reemplazarse con VPS workflow

ARCHIVOS:
- Leer: README.md (496 l√≠neas)
- Modificar: README.md (l√≠neas 24, 312-328)

ESPECIFICACIONES:

1. Actualizar l√≠nea 24 (Stack Tecnol√≥gico):
   ```markdown
   ANTES: - **Deploy**: Vercel US East
   DESPU√âS: - **Deploy**: VPS Hostinger (innpilot.io) + GitHub Actions
   ```

2. Reemplazar secci√≥n Deploy (l√≠neas 312-328):
   ```markdown
   ## üöÄ Deploy

   ### Production Deployment (VPS Hostinger)

   La aplicaci√≥n se despliega autom√°ticamente v√≠a GitHub Actions cuando se hace push a `dev`.

   **Deployment Workflow:**
   ```bash
   git push origin dev
   # ‚Üí GitHub Actions build + deploy
   # ‚Üí Live on https://innpilot.io (< 5min)
   ```

   **Manual Deployment:**
   Ver gu√≠a completa en [docs/deployment/VPS_SETUP_GUIDE.md](docs/deployment/VPS_SETUP_GUIDE.md)

   **Verificaci√≥n:**
   ```bash
   # Health check
   curl https://innpilot.io/api/health

   # Check SSL
   curl -vI https://innpilot.io
   ```

   **Logs:**
   ```bash
   # SSH to VPS
   ssh user@innpilot.io

   # View PM2 logs
   pm2 logs innpilot

   # View Nginx logs
   sudo tail -f /var/log/nginx/innpilot-access.log
   sudo tail -f /var/log/nginx/innpilot-error.log
   ```

   ### Variables de Entorno en VPS

   Configurar las variables de `.env.local` en el servidor VPS.
   Ver [docs/deployment/VPS_SETUP_GUIDE.md](docs/deployment/VPS_SETUP_GUIDE.md) para detalles.
   ```

TEST:
```bash
# Verificar referencias a Vercel eliminadas
grep -i "vercel" README.md  # Debe retornar 0 resultados

# Verificar nuevas referencias a VPS
grep -c "innpilot.io" README.md  # Debe retornar >5

# Verificar links a docs/deployment/
grep -c "docs/deployment/" README.md  # Debe retornar >2
```

SIGUIENTE: FASE 1 completa ‚Üí FASE 2 (GitHub Actions)
```

---

## FASE 2: GitHub Actions Workflow (2h)

### Prompt 2.1: para Crear estructura y deploy.yml usemos @backend-developer

TAREA: Crear GitHub Actions workflow completo para deployment autom√°tico

CONTEXTO:
- Proyecto: VPS Deployment Migration
- Target: VPS Hostinger (innpilot.io)
- Trigger: push to dev
- Workflow: build ‚Üí deploy SSH ‚Üí restart PM2 ‚Üí health check ‚Üí rollback si falla

ARCHIVOS:
- Crear: .github/workflows/deploy.yml (~150 l√≠neas)

ESPECIFICACIONES:

Crear archivo `.github/workflows/deploy.yml` con el siguiente contenido:

```yaml
name: Deploy to VPS

on:
  push:
    branches:
      - dev

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci --legacy-peer-deps

      - name: Build application
        run: npm run build
        env:
          NODE_ENV: production

      - name: Deploy to VPS
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.VPS_SSH_KEY }}
          script: |
            cd ${{ secrets.VPS_APP_PATH }}
            git pull origin dev
            npm ci --legacy-peer-deps --production
            npm run build
            pm2 restart innpilot

      - name: Wait for deployment
        run: sleep 10

      - name: Health check
        run: |
          response=$(curl -s -o /dev/null -w "%{http_code}" https://innpilot.io/api/health)
          if [ $response != "200" ]; then
            echo "Health check failed with status $response"
            exit 1
          fi
          echo "Health check passed: $response"

      - name: Rollback on failure
        if: failure()
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.VPS_SSH_KEY }}
          script: |
            cd ${{ secrets.VPS_APP_PATH }}
            git reset --hard HEAD~1
            npm ci --legacy-peer-deps --production
            npm run build
            pm2 restart innpilot
            echo "Rolled back to previous version"

      - name: Notify success
        if: success()
        run: |
          echo "‚úÖ Deployment successful!"
          echo "üåê https://innpilot.io is live"
```

TEST:
```bash
# Verificar archivo creado
ls -la .github/workflows/deploy.yml

# Verificar sintaxis YAML v√°lida
cat .github/workflows/deploy.yml | grep "name: Deploy to VPS"

# Verificar steps principales
grep -c "name:" .github/workflows/deploy.yml  # Debe retornar 8 (8 steps)
```

SIGUIENTE: Prompt 2.2 para documentar GitHub Secrets
```

---

### Prompt 2.2: Documentar GitHub Secrets

```
ahora,  @backend-developer ay√∫dame a Crear gu√≠a de configuraci√≥n de GitHub Secrets

CONTEXTO:
El workflow de GitHub Actions necesita 10 secrets configurados

ARCHIVOS:
- Crear: docs/deployment/GITHUB_SECRETS.md (~80 l√≠neas)

ESPECIFICACIONES:

Crear archivo `docs/deployment/GITHUB_SECRETS.md` con el siguiente contenido:

```markdown
# GitHub Secrets Configuration

Esta gu√≠a explica c√≥mo configurar los Secrets necesarios para el deployment autom√°tico via GitHub Actions.

## Acceso a GitHub Secrets

1. Ve al repositorio: https://github.com/toneill57/innpilot
2. Click en **Settings** (tab superior)
3. En el men√∫ izquierdo: **Secrets and variables** ‚Üí **Actions**
4. Click en **New repository secret**

---

## Secrets Requeridos

### 1. VPS_HOST
**Descripci√≥n:** IP o hostname del servidor VPS Hostinger

**Valor:** `123.45.67.89` o `innpilot.io`

**C√≥mo obtenerlo:**
- Panel de Hostinger ‚Üí VPS ‚Üí Informaci√≥n del servidor ‚Üí IP Address

---

### 2. VPS_USER
**Descripci√≥n:** Usuario SSH para conectar al VPS

**Valor:** `root` o `innpilot` (usuario creado)

**C√≥mo obtenerlo:**
- Usuario root por defecto en Hostinger VPS
- O usuario creado durante setup inicial

---

### 3. VPS_SSH_KEY
**Descripci√≥n:** Private SSH key para autenticaci√≥n sin password

**Valor:** Contenido completo de tu clave privada

**C√≥mo generarlo:**
```bash
# En tu m√°quina local
ssh-keygen -t rsa -b 4096 -C "github-actions@innpilot.io"
# Guardar en: ~/.ssh/innpilot_deploy

# Copiar clave p√∫blica al servidor
ssh-copy-id -i ~/.ssh/innpilot_deploy.pub user@innpilot.io

# Obtener clave privada para GitHub Secret
cat ~/.ssh/innpilot_deploy
# Copiar TODO el output (incluyendo BEGIN/END lines)
```

---

### 4. VPS_APP_PATH
**Descripci√≥n:** Path absoluto donde est√° la aplicaci√≥n en el VPS

**Valor:** `/var/www/innpilot`

---

### 5. SUPABASE_URL
**Descripci√≥n:** URL de tu proyecto Supabase

**Valor:** `https://ooaumjzaztmutltifhoq.supabase.co`

**C√≥mo obtenerlo:**
- Supabase Dashboard ‚Üí Settings ‚Üí API ‚Üí Project URL

---

### 6. SUPABASE_ANON_KEY
**Descripci√≥n:** Supabase anonymous/public key

**Valor:** `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`

**C√≥mo obtenerlo:**
- Supabase Dashboard ‚Üí Settings ‚Üí API ‚Üí anon/public key

---

### 7. SUPABASE_SERVICE_ROLE_KEY
**Descripci√≥n:** Supabase service role key (secret)

**Valor:** `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`

**C√≥mo obtenerlo:**
- Supabase Dashboard ‚Üí Settings ‚Üí API ‚Üí service_role key (secret)

---

### 8. OPENAI_API_KEY
**Descripci√≥n:** OpenAI API key para embeddings

**Valor:** `sk-proj-...`

**C√≥mo obtenerlo:**
- OpenAI Platform ‚Üí API Keys ‚Üí Create new secret key

---

### 9. ANTHROPIC_API_KEY
**Descripci√≥n:** Anthropic API key para Claude

**Valor:** `sk-ant-api03-...`

**C√≥mo obtenerlo:**
- Anthropic Console ‚Üí API Keys ‚Üí Create key

---

### 10. JWT_SECRET_KEY
**Descripci√≥n:** Secret key para JWT authentication

**Valor:** String aleatorio de 64+ caracteres

**C√≥mo generarlo:**
```bash
openssl rand -base64 64
```

---

## Verificaci√≥n

Despu√©s de configurar todos los secrets:

1. Ve a: **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
2. Debes ver 10 secrets listados
3. Ning√∫n secret debe mostrar su valor (solo nombre)

## Seguridad

‚ö†Ô∏è **IMPORTANTE:**
- **NUNCA** comittees secrets en el c√≥digo
- **NUNCA** compartas secrets en chat/email
- Rota secrets peri√≥dicamente (cada 90 d√≠as)
- Usa secrets diferentes para dev/prod
```

TEST:
```bash
# Verificar archivo creado
ls -la docs/deployment/GITHUB_SECRETS.md

# Verificar 10 secrets documentados
grep -c "^### [0-9]\+\." docs/deployment/GITHUB_SECRETS.md  # Debe retornar 10
```

SIGUIENTE: FASE 2 completa ‚Üí FASE 3 (VPS Setup Guide)
```

---

## FASE 3: VPS Server Setup Guide (3h)

### Prompt 3.1: Crear VPS_SETUP_GUIDE.md completa

```
@backend-developer

TAREA: Crear gu√≠a completa de setup del VPS Hostinger

CONTEXTO:
Gu√≠a paso a paso para configurar servidor desde cero hasta app funcionando con SSL

ARCHIVOS:
- Crear: docs/deployment/VPS_SETUP_GUIDE.md (~400 l√≠neas)
- Crear: docs/deployment/ directory si no existe

ESPECIFICACIONES:

La gu√≠a debe cubrir 5 secciones principales:
1. Configuraci√≥n Inicial del Servidor
2. Configuraci√≥n de Aplicaci√≥n
3. Configuraci√≥n de PM2
4. Configuraci√≥n de Nginx
5. SSL Setup con Let's Encrypt

**NOTA:** Debido a la longitud de este archivo, revisar plan.md l√≠neas 200-350 para el contenido completo.

Incluir:
- Comandos completos copy-paste ready
- Explicaciones breves de cada paso
- Warnings para pasos cr√≠ticos
- Verificaciones despu√©s de cada secci√≥n

TEST:
```bash
# Verificar archivo creado
ls -la docs/deployment/VPS_SETUP_GUIDE.md

# Verificar 5 secciones principales
grep -c "^## [0-9]\." docs/deployment/VPS_SETUP_GUIDE.md  # Debe retornar 5

# Verificar longitud adecuada
wc -l docs/deployment/VPS_SETUP_GUIDE.md  # Debe ser ~400 l√≠neas
```

SIGUIENTE: Prompt 3.2 para ecosystem.config.js
```

---

### Prompt 3.2: Crear ecosystem.config.js (PM2)

```
@backend-developer

TAREA: Crear configuraci√≥n de PM2 para producci√≥n

CONTEXTO:
PM2 gestionar√° el proceso Node.js en modo cluster

ARCHIVOS:
- Crear: docs/deployment/ecosystem.config.js (~25 l√≠neas)

ESPECIFICACIONES:

Crear archivo `docs/deployment/ecosystem.config.js`:

```javascript
module.exports = {
  apps: [{
    name: 'innpilot',
    script: 'npm',
    args: 'start',
    cwd: '/var/www/innpilot',
    instances: 2,
    exec_mode: 'cluster',
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: '/var/log/pm2/innpilot-error.log',
    out_file: '/var/log/pm2/innpilot-out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
    merge_logs: true,
    time: true
  }]
}
```

**Notas:**
- 2 instances para VPS con 2 CPU cores
- Cluster mode para load balancing
- Max memory 1GB por instance
- Logs en /var/log/pm2/

TEST:
```bash
# Verificar sintaxis JavaScript
node -e "require('./docs/deployment/ecosystem.config.js')"

# Verificar configuraci√≥n
cat docs/deployment/ecosystem.config.js | grep "name: 'innpilot'"
```

SIGUIENTE: Prompt 3.3 para nginx-innpilot.conf
```

---

### Prompt 3.3: Crear nginx-innpilot.conf

```
@backend-developer

TAREA: Crear configuraci√≥n de Nginx optimizada

CONTEXTO:
Nginx como reverse proxy para Next.js con rate limiting y SSL

ARCHIVOS:
- Crear: docs/deployment/nginx-innpilot.conf (~80 l√≠neas)

ESPECIFICACIONES:

**NOTA:** Ver plan.md l√≠neas 280-320 para configuraci√≥n completa de Nginx.

Incluir:
- Rate limiting (10 req/s para /api/)
- Compression (gzip)
- Security headers
- Proxy settings optimizados para Next.js
- Timeouts para API requests largos (60s)
- Logging configurado

TEST:
```bash
# Verificar sintaxis Nginx (simulaci√≥n)
cat docs/deployment/nginx-innpilot.conf | grep "server_name innpilot.io"

# Verificar rate limiting configurado
grep -c "limit_req" docs/deployment/nginx-innpilot.conf  # Debe retornar >1
```

SIGUIENTE: Prompt 3.4 para vps-setup.sh
```

---

### Prompt 3.4: Crear vps-setup.sh

```
@backend-developer

TAREA: Crear script automatizado de setup inicial del VPS

CONTEXTO:
Script para instalar todas las dependencias del servidor

ARCHIVOS:
- Crear: scripts/vps-setup.sh (~50 l√≠neas)

ESPECIFICACIONES:

Crear script bash ejecutable que instale:
1. Node.js 20.x LTS
2. PM2 global
3. Nginx
4. Certbot (Let's Encrypt)
5. Git

Incluir:
- Shebang: `#!/bin/bash`
- Set -e (exit on error)
- Mensajes informativos
- Verificaciones post-instalaci√≥n

TEST:
```bash
# Verificar sintaxis bash
bash -n scripts/vps-setup.sh

# Verificar ejecutable
chmod +x scripts/vps-setup.sh
ls -l scripts/vps-setup.sh | grep "x"  # Debe mostrar permisos de ejecuci√≥n
```

SIGUIENTE: FASE 3 completa ‚Üí FASE 4 (Deploy Agent Refactor final)
```

---

## FASE 4: Deploy Agent Refactor Final (1h)

### Prompt 4.1: Validar deploy-agent.md refactor

```
@backend-developer

TAREA: Validar que deploy-agent.md est√° completamente actualizado

CONTEXTO:
Verificar que no queden referencias a Vercel y que el workflow est√© actualizado

ARCHIVOS:
- Revisar: .claude/agents/deploy-agent.md

VERIFICACIONES:

1. URL correcta en todos los lugares:
   ```bash
   grep -c "innpilot.io" .claude/agents/deploy-agent.md  # Debe ser >5
   grep -c "vercel.app" .claude/agents/deploy-agent.md  # Debe ser 0
   ```

2. Workflow actualizado menciona GitHub Actions:
   ```bash
   grep -c "GitHub Actions" .claude/agents/deploy-agent.md  # Debe ser >1
   ```

3. Endpoints de verificaci√≥n correctos:
   - https://innpilot.io/api/health
   - https://innpilot.io/api/chat
   - https://innpilot.io/api/chat/muva

4. Performance esperada documentada: ~0.490s response time

Si alguna verificaci√≥n falla, actualizar el archivo seg√∫n plan.md FASE 4.

SIGUIENTE: FASE 4 completa ‚Üí FASE 5 (Testing & Documentation final)
```

---

## FASE 5: Testing & Documentation Final (1h)

### Prompt 5.1: Crear DEPLOYMENT_WORKFLOW.md

```
@backend-developer

TAREA: Documentar workflow completo de deployment

CONTEXTO:
Gu√≠a de referencia r√°pida para deployments y troubleshooting

ARCHIVOS:
- Crear: docs/deployment/DEPLOYMENT_WORKFLOW.md (~150 l√≠neas)

ESPECIFICACIONES:

Secciones:

1. **Overview del Proceso**
   - Diagrama de flujo: Developer ‚Üí GitHub ‚Üí VPS
   - Timeline esperado: < 5min total

2. **Deployment Autom√°tico**
   - Push to dev
   - GitHub Actions workflow
   - Verificaci√≥n post-deploy

3. **Deployment Manual**
   - SSH al servidor
   - git pull
   - npm ci && npm run build
   - pm2 restart innpilot

4. **Rollback**
   - Autom√°tico (v√≠a GitHub Actions)
   - Manual (comandos git reset + rebuild)

5. **Monitoreo**
   - Health checks
   - PM2 status
   - Nginx logs
   - Application logs

TEST:
```bash
# Verificar archivo creado
ls -la docs/deployment/DEPLOYMENT_WORKFLOW.md

# Verificar 5 secciones
grep -c "^## [0-9]\." docs/deployment/DEPLOYMENT_WORKFLOW.md  # Debe retornar 5
```

SIGUIENTE: Prompt 5.2 para TROUBLESHOOTING.md
```

---

### Prompt 5.2: Crear TROUBLESHOOTING.md

```
@backend-developer

TAREA: Crear gu√≠a de troubleshooting de problemas comunes

CONTEXTO:
Documentar 7 problemas comunes con s√≠ntomas, causas y soluciones

ARCHIVOS:
- Crear: docs/deployment/TROUBLESHOOTING.md (~200 l√≠neas)

ESPECIFICACIONES:

Documentar cada problema con:
- **S√≠ntoma**: Qu√© ves
- **Causa**: Por qu√© pasa
- **Soluci√≥n**: C√≥mo solucionarlo (comandos espec√≠ficos)

Problemas a cubrir:

1. Build fails en GitHub Actions
2. SSH connection timeout
3. PM2 process crashes
4. Nginx 502 Bad Gateway
5. SSL certificate renewal fails
6. Health check fails
7. API endpoints returning errors

TEST:
```bash
# Verificar archivo creado
ls -la docs/deployment/TROUBLESHOOTING.md

# Verificar 7 problemas documentados
grep -c "^### [0-9]\." docs/deployment/TROUBLESHOOTING.md  # Debe retornar 7
```

SIGUIENTE: Prompt 5.3 para actualizar CLAUDE.md
```

---

### Prompt 5.3: Actualizar CLAUDE.md

```
@backend-developer

TAREA: Actualizar CLAUDE.md con proyecto actual

CONTEXTO:
Reemplazar "Fixed Layout Migration" con "VPS Deployment Migration"

ARCHIVOS:
- Modificar: CLAUDE.md (l√≠neas 50-120)

ESPECIFICACIONES:

Reemplazar secci√≥n "üéØ CURRENT PROJECT" (l√≠neas 50-120) con:

```markdown
## üéØ CURRENT PROJECT: VPS Deployment Migration (Oct 2025)

### Objective
Migrar deployment de Vercel a VPS Hostinger con CI/CD autom√°tico via GitHub Actions

### Project Files
- üìÑ **Plan**: `plan.md` (610 l√≠neas) - Arquitectura completa, 5 fases
- üìã **Tasks**: `TODO.md` (208 l√≠neas) - 28 tareas organizadas
- üéØ **Prompts**: `vps-deployment-workflow.md` (650 l√≠neas) - Prompts ejecutables

### Status
- **Planning**: ‚úÖ Complete
- **FASE 1**: üîú Ready (Limpieza Vercel - 1h)
- **FASE 2**: Pending (GitHub Actions - 2h)
- **FASE 3**: Pending (VPS Setup Guide - 3h)
- **FASE 4**: Pending (Deploy Agent Refactor - 1h)
- **FASE 5**: Pending (Testing & Docs - 1h)

### Key Specs
- **VPS**: Hostinger (Ubuntu 22.04)
- **Domain**: innpilot.io
- **CI/CD**: GitHub Actions (push to dev = auto-deploy)
- **Infrastructure**: Nginx + PM2 + Let's Encrypt SSL
- **Timeline**: 8 horas total

---
```

TEST:
```bash
# Verificar actualizaci√≥n
grep -c "VPS Deployment Migration" CLAUDE.md  # Debe retornar >1

# Verificar referencias a archivos correctos
grep -c "plan.md.*610 l√≠neas" CLAUDE.md  # Debe retornar 1
```

SIGUIENTE: Prompt 5.4 para testing end-to-end
```

---

### Prompt 5.4: Testing End-to-End Completo

```
@backend-developer

TAREA: Ejecutar checklist completo de testing de deployment

CONTEXTO:
Validar que todo el flujo de deployment funciona correctamente

TESTING CHECKLIST:

1. **GitHub Actions Trigger**
   ```bash
   # Hacer un cambio trivial y push
   echo "# Deployment test" >> README.md
   git add README.md
   git commit -m "test: validate deployment workflow"
   git push origin dev

   # Verificar workflow triggerado
   # Ir a: https://github.com/toneill57/innpilot/actions
   # Debe aparecer nuevo workflow "Deploy to VPS"
   ```

2. **Build Completes**
   - Workflow debe completar en < 3min
   - Todos los steps en verde ‚úÖ
   - No hay errores en logs

3. **Deploy to VPS Executes**
   ```bash
   # SSH al servidor
   ssh user@innpilot.io

   # Verificar √∫ltima actualizaci√≥n
   cd /var/www/innpilot
   git log -1 --oneline  # Debe mostrar √∫ltimo commit
   ```

4. **PM2 Restart Works**
   ```bash
   # En el servidor
   pm2 status innpilot
   # Debe mostrar: online, uptime reciente, 0 restarts
   ```

5. **Health Check Passes**
   ```bash
   curl https://innpilot.io/api/health
   # Debe retornar: {"status":"healthy","services":{...}}
   ```

6. **Chat Endpoint Funciona**
   ```bash
   curl -X POST https://innpilot.io/api/chat \
     -H "Content-Type: application/json" \
     -d '{"question":"Hola","use_context":true}'
   # Debe retornar respuesta JSON v√°lida
   ```

7. **MUVA Endpoint Funciona**
   ```bash
   curl -X POST https://innpilot.io/api/chat/muva \
     -H "Content-Type: application/json" \
     -d '{"question":"Playas en San Andr√©s","use_context":true}'
   # Debe retornar respuesta JSON v√°lida
   ```

8. **SSL Certificate V√°lido**
   ```bash
   curl -vI https://innpilot.io 2>&1 | grep "TLS"
   # Debe mostrar: TLSv1.3 o TLSv1.2

   # Verificar en SSL Labs
   # https://www.ssllabs.com/ssltest/analyze.html?d=innpilot.io
   # Debe obtener rating A o A+
   ```

9. **Response Time Comparable**
   ```bash
   # Medir tiempo de respuesta
   time curl -s https://innpilot.io/api/health > /dev/null
   # Debe ser similar a Vercel (~0.490s)
   ```

CRITERIOS DE √âXITO:
- ‚úÖ Todos los checks pasan
- ‚úÖ No hay errores en logs
- ‚úÖ Response time aceptable
- ‚úÖ SSL v√°lido

Si alg√∫n check falla:
1. Revisar logs de GitHub Actions
2. SSH al servidor y revisar logs de PM2/Nginx
3. Consultar docs/deployment/TROUBLESHOOTING.md

SIGUIENTE: Proyecto completo ‚úÖ
```

---

## üìã DOCUMENTACI√ìN FINAL

### Prompt: Resumen de Archivos Creados

```
He completado la migraci√≥n de Vercel a VPS. Resumen de archivos:

**ARCHIVOS CREADOS:**
- ‚úÖ plan.md (610 l√≠neas)
- ‚úÖ TODO.md (208 l√≠neas)
- ‚úÖ vps-deployment-workflow.md (650 l√≠neas)
- ‚úÖ .github/workflows/deploy.yml (150 l√≠neas)
- ‚úÖ docs/deployment/GITHUB_SECRETS.md (80 l√≠neas)
- ‚úÖ docs/deployment/VPS_SETUP_GUIDE.md (400 l√≠neas)
- ‚úÖ docs/deployment/ecosystem.config.js (25 l√≠neas)
- ‚úÖ docs/deployment/nginx-innpilot.conf (80 l√≠neas)
- ‚úÖ docs/deployment/DEPLOYMENT_WORKFLOW.md (150 l√≠neas)
- ‚úÖ docs/deployment/TROUBLESHOOTING.md (200 l√≠neas)
- ‚úÖ scripts/vps-setup.sh (50 l√≠neas)

**ARCHIVOS MODIFICADOS:**
- ‚úÖ package.json (eliminado script deploy)
- ‚úÖ .gitignore (eliminadas referencias Vercel)
- ‚úÖ .claude/agents/deploy-agent.md (refactor completo)
- ‚úÖ README.md (secci√≥n Deploy actualizada)
- ‚úÖ CLAUDE.md (proyecto actual actualizado)

**ARCHIVOS ELIMINADOS:**
- ‚úÖ vercel.json

**TOTAL:**
- Creados: 11 archivos (~2,453 l√≠neas)
- Modificados: 5 archivos
- Eliminados: 1 archivo

**PR√ìXIMOS PASOS:**
1. Configurar GitHub Secrets (docs/deployment/GITHUB_SECRETS.md)
2. Setup VPS Hostinger (docs/deployment/VPS_SETUP_GUIDE.md)
3. Hacer push to dev para triggear primer deploy autom√°tico
4. Validar con checklist de testing (Prompt 5.4)

üéâ **Migraci√≥n lista para ejecutar!**
```

---

**√öltima actualizaci√≥n:** 4 de Octubre 2025
